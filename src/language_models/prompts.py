from langchain_core.prompts import ChatPromptTemplate

FIRST_CHUNK_SYSTEM_PROMPT = '''
                  استخرج جميع الشخصيات المذكورة أو المشار إليها في النص بدقة، مع استخراج كل المعلومات التالية **حصراً من النص نفسه** دون أي معلومات خارجية:

                  لكل شخصية، حدد:
                  1. **"عمرها التقديري"**: إذا لم يكن واضحًا، ضع "غير معروف".
                  2. **"دورها في النص"**: (رئيسي، ثانوي، هامشي... أو أي تصنيف دقيق حسب دورها الفعلي). إذا لم يكن واضحًا، ضع "غير معروف".
                  3. **"الصفات النفسية والجسدية"** المذكورة في النص: إن لم تذكر، ضع "غير معروف". *(ضع الإجابة على شكل list[])*.
                  4. **"أهم الأحداث التي مرت بها الشخصية"**: إذا لم تذكر، ضع "غير معروف". *(ضع الإجابة على شكل list[])*.
                  5. **"العلاقات بين الشخصيات الأخرى المذكورة"**: مع تحديد **نوع العلاقة بدقة** (مثال: "فلان وفلان علاقة أخوة"، "فلان وفلان علاقة زواج"، "فلان وفلان علاقة عداء"، إلخ).
                    - إذا لم تكن هناك علاقة واضحة، ضع `"لا يوجد علاقة واضحة"`.

                  **تحذير:** يجب استخراج **جميع الشخصيات بدون استثناء**، والتأكد من **عدم إغفال أي معلومة** تتعلق بهم.

                  ملاحظة: نسق الجواب بصيغة JSON.
                  مثال على التنسيق :
                  [
                  {{
                    "name": "الطفلة",
                    "age": "غير معروف",
                      "role": "ثانوي",
                      "personality":["أمل", "حب"] ,
                      "physical characteristics":["بيضاء كالثلج, شعرهاأسود كالليل,عيناها زرقاء مثل السماء"] ,
                      "events": ["حلم الملكة", "تأثير على الملكة الجديدة"],
                      "relations":[ "الطفلة والملكة: علاقة امومة","الطفلة والملك:علاقة ابوة" ]
                      }}
                  ]
                  ملاحظة هامة: بعد استخراج المعلومات قم بالتاكد من جميع الاجوبة المستخرجة من خلال المقارنة بينها وبين النص الموجود..انتبه في حال وجود اخطاء قم بتصحيحها
'''

OTHER_CHUNK_SYSTEM_PROMPT = '''
            انت تحلل النصوص العربية وتستخرج المعلومات الهامة منها.
          أنت ستتلقى نصًا من رواية عربية مقسمًا إلى أجزاء صغيرة. ستتلقى أيضًا ناتج سابق تم استخراج المعلومات منه.
          ،ستقوم باستخراج المعلومات الجديدة من الجزء الجديد وتحديث الناتج السابق بمعلومات جديدة ،
          أثناء تحديث معلومات الشخصية يمكنك اعادة صياغة الاحداث المترابطة بحيث لا تكون الجمل قصيرة ولا تجعل حقل الأحداث طويلا جدا،
          اذا كان هناك احداث غير مفصلية لا تنقلها معك للقسم التالي
          تأكد من تحديث كافة الافسام في حال وجدت اي معلومة يمكن وضعها في القسم المناسب لها حصراً


          قم بالاستمرار في استخراج المعلومات الهامة من الجزء الجديد وتحديث الناتج السابق بالمعلومات الجديدة حصرا من النص المرفق دون اي معلومة من الخارج إذا كانت موجودة.اعد الناتج بنفس الصيغة من Json كما سابقتها ولا تغير ال اي اسم Key.
          لكل شخصية ، حدد:
          1. **"العمر التقديري"**: إذا لم يكن واضحًا، ضع "غير معروف".
          2. **"دورها في النص"**: (رئيسي، ثانوي، هامشي... أو أي تصنيف دقيق حسب دورها الفعلي). إذا لم يكن واضحًا، ضع "غير معروف".
          3. **"الصفات النفسية والجسدية"** المذكورة في النص: إن لم تذكر، ضع "غير معروف". *(ضع الإجابة على شكل list[])*.

          4. **"العلاقات بين الشخصيات الأخرى المذكورة"**: مع تحديد **نوع العلاقة بدقة** (مثال: "فلان وفلان علاقة أخوة"، "فلان وفلان علاقة زواج"، "فلان وفلان علاقة عداء"، إلخ).
            - إذا لم تكن هناك علاقة واضحة، ضع `"لا يوجد علاقة واضحة"`.

          **تحذير:** يجب استخراج **جميع الشخصيات بدون استثناء**، والتأكد من **عدم إغفال أي معلومة هامة ** تتعلق بهم.
            اذا لم  تقم بأي تغيير على شخصية غير اساسية في القصة لا ترجعها مع الخرج دون تخريب شكل الخرج.
       ملاحظة:   لا تستخرج كل الأحداث العادية اهتم فقط بالتفاصيل المحورية التي تغير شكل القصة مثل (القرارات /الصراعات/الادراك....)
           إذا تم تغيير اسم شخصية بشكل كامل الإشارة إليها بشكل غامض (مثل "الرجل"، "هو") وكانت هذه الشخصية مستخرجة سابقاً،
          فقم بمحاولة ربطها بالشخصية السابقة وانتبه ان تخلط بين شخصيتين بنفس الاسم فقط بسبب الاشارة لهم ينفس الطريقة،
          وأضف حقل "aliases"
          يتضمن جميع الصيغ التي وردت للشخصية في النص.
          ملاحظة: نسق الجواب بصيغة JSON.
          مثال على التنسيق :
          [
          {{
            "name": "الطفلة",
            "age": "غير معروف",
              "role": "ثانوي",
              "personality":["أمل", "حب"] ,
              "physical characteristics":["بيضاء كالثلج, شعرهاأسود كالليل,عيناها زرقاء مثل السماء"] ,
              "events": ["حلم الملكة", "تأثير على الملكة الجديدة"],
              "relations":[ "الطفلة والملكة: علاقة امومة","الطفلة والملك:علاقة ابوة" ]
              }}
              ]'''


first_chunk_prompt = ChatPromptTemplate.from_messages([
    ("system", FIRST_CHUNK_SYSTEM_PROMPT),
    ("human", "النص: {text}")
])

other_chunk_prompt = ChatPromptTemplate.from_messages([
    ("system", OTHER_CHUNK_SYSTEM_PROMPT),
    ("human", "النص: {text}\nالملفات الشخصية: {profiles}")
])
